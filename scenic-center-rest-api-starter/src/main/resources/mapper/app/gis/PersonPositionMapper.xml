<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.daqsoft.mapper.app.gis.PersonPositionMapper">

    <resultMap id="BaseResultMap" type="com.daqsoft.entity.app.gis.PersonpPosition">
        <id column="ID" property="id" jdbcType="BIGINT"/>
        <result column="PERSON_ID" property="personId" jdbcType="BIGINT"/>
        <result column="LOCA_NAME" property="locaName" jdbcType="VARCHAR"/>
        <result column="LONGITUDE" property="longitude" jdbcType="VARCHAR"/>
        <result column="LATITUDE" property="latitude" jdbcType="VARCHAR"/>
        <result column="DATETIME" property="datetime" jdbcType="TIMESTAMP"/>
        <result column="VCODE" property="vcode" jdbcType="VARCHAR"/>
    </resultMap>

    <sql id="Base_Column_List">
       ID, PERSON_ID as personId,LOCA_NAME as locaName,LONGITUDE,LATITUDE,DATE_FORMAT(dateTime, '%Y-%m-%d %H:%i:%s') as dateTime,VCODE
    </sql>

    <insert id="insertLocation"  parameterType="Map" >
        insert into ele_person_location ( PERSON_ID, LOCA_NAME, LONGITUDE, LATITUDE, DATETIME,VCODE)
        values (#{personId}, #{locationName}, #{longitude},
        #{latitude}, now(),
        #{vcode})
    </insert>

    <!--app人员定位-->
    <select id="personLocaInfo" resultType="Map" parameterType="Map">
        select
            id, PERSON_ID as personId,
            LOCA_NAME as locaName,longitude,latitude,
            DATE_FORMAT(dateTime, '%Y-%m-%d %H:%i:%s') as dateTime
        from ELE_PERSON_LOCATION
        where VCODE = #{vcode} and PERSON_ID = #{personId}
        <if test="date != null ">
            AND  dateTime BETWEEN '${date} 00:00:00' and '${date} 23:59:59'
        </if>
    </select>

</mapper>