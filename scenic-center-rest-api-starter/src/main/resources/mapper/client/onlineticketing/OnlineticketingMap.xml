<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.daqsoft.mapper.client.onlineticketing.OnlineTicketingDao">

    <!--网络票务 -->
    <select id="getOta" parameterType="String"
            resultType="com.daqsoft.vo.client.mysqlBean.OtaDate">
		<![CDATA[

          select s.id ,s.NAME ,SUM(s.COUNT) as COUNT,SUM(s.totalPrice) as totalPrice from jq_ota_data AS  s
            where s.vcode=#{vcode} and time > current_date GROUP BY name

        ]]>
	</select>

    <!--网络票务分析，分销商订单数 金额-->
    <select id="getOtaOrderNumPrice" parameterType="Map"
            resultType="com.daqsoft.vo.client.mysqlBean.OtaDate">
        <![CDATA[

          SELECT s. NAME ,SUM(s.COUNT) AS COUNT ,IFNULL(SUM(s.totalPrice),0) AS totalPrice
            FROM
                jq_ota_data AS s
            WHERE
                1=1 and s.vcode = #{vcode}
                and time BETWEEN #{startTime} and  #{endTime}
                GROUP BY name

        ]]>
    </select>


    <!--网络票务分析，分销商订单数 金额-->
    <select id="getOnlineCountByMonth" parameterType="Map"
            resultType="com.daqsoft.vo.client.mysqlBean.OtaTendVo">
        <![CDATA[

          SELECT
                sum(jod.count) AS ota_num ,
                ifnull(sum(jod.totalprice) , 0) AS ota_totalPrice ,
                DATE_FORMAT(jod.time , '%Y-%m') AS ota_time
            FROM
                jq_ota_data AS jod
            WHERE
                1 = 1
            AND jod.vcode = #{vcode}
            AND jod.time BETWEEN #{startTime} AND #{endTime}
            GROUP BY
                DATE_FORMAT(jod.time , '%Y-%m')
            ORDER BY
                DATE_FORMAT(jod.time , '%Y-%m')

        ]]>
    </select>


</mapper>
